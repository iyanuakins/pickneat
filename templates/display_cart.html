{%extends "layout2.html" %}

{% block title %}
    Cart Info
{%endblock%}

{% block main %}
    {% if cart_menu %}
        <form action="/process_cart" method="POST">
            <div class="container">
                <table action="/process_cart" method="POST" id="table_id" class="table table-striped" style="width:100%">
                        <thead>
                            <tr>
                                <th>Meal</th>
                                <th>Vendor</th>
                                <th>Price</th>
                                <th>Quantity</th>
                                <th>Total Cost</th>
                                <th>Preview</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for order in cart_menu %}
                                <tr>                                    
                                    <td>{{order['name']}}</td>
                                    <td>{{order['vendor']}}</td>
                                    <td><input type="text" class="form-control"  value="{{order['quantity']}}" name="{{order['id']}}"></td>
                                    <td><input type="text" class="form-control1" readonly value="{{order['price']}}" name="price" ></td>
                                    <td><input type="text" class="form-control2" readonly value="" name="quantity" ></td>
                                    <td><img src="{{order['image']}}" style="width:20vw; height:10vw" alt="Cannot Display Food Preview" class="img-fluid"></td>
                                </tr>
                            {% endfor %}
                            </tbody>
                            <tfoot>
                                <tr>                                    
                                    <th colspan="4">Total Cost</th>
                                    <th><input type="text" class="form-control"  readonly id="total_cost" value="" name=""></th>
                                </tr>
                            </tfoot>
                    </table>
                </div>
                <div class="form-group">
                    <a href="/clear_cart" class="float-left" ><input type="button" value="Clear Cart" class="btn btn-info"></a>
                    <input type="submit" value="Process Cart" class="btn btn-success float-right">
                </div>
        </form>
    {% else %}
        <div class="card-group mt-5">
            <div class="card">
                <div class="card-body">
                <h5 class="card-title">Empty Cart</h5>
                <p class="card-text">Your cart is empty at the moment...</p>
                </div>
            </div>
        </div>
    {% endif %}
<script>
    $('document').ready(()=>{
        let quantity = $('.form-control').serializeArray()
        let price = $('.form-control1').serializeArray()
        let totalCost = 0
        $(".form-control2").map(function(index) {
            this.value = parseInt(quantity[index]['value']) * parseInt(price[index]['value'])
            totalCost += parseInt(this.value)
        })

        $('#total_cost').val(totalCost)


        $('.form-control').blur(function(){
            let quantity = $('.form-control').serializeArray()
            let price = $('.form-control1').serializeArray()
            let totalCost = 0
            $(".form-control2").map(function(index) {
                this.value = parseInt(quantity[index]['value']) * parseInt(price[index]['value'])
                totalCost += parseInt(this.value)
            })
    
            $('#total_cost').val(totalCost)
        })
    })
</script>
{% endblock %}  